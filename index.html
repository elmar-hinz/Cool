<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Cool : a tiny autowiring PHP framework" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cool</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/t3elmar/Cool">View on GitHub</a>

          <h1 id="project_title">Cool</h1>
          <h2 id="project_tagline">a tiny autowiring PHP framework</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/t3elmar/Cool/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/t3elmar/Cool/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1></h1>

<h1>Cool - a tiny autowiring PHP framework</h1>

<ul>
<li>Author: Elmar Hinz <a href="mailto:t3elmar@googlemail.com">t3elmar@googlemail.com</a>
</li>
<li>Homepage: </li>
<li>Version: 0.x.x</li>
<li>Stability: Alpha/Usable</li>
<li>License: MIT</li>
<li>Last update: See <a href="https://github.com/t3elmar/Cool/blob/master/ChangeLog">ChangeLog</a>
</li>
<li>OS: tested on POSIX i.e. Mac OS X, Unix, Linux, BSD</li>
<li>Dependencies: 

<ul>
<li>php &gt; 5.3</li>
<li>git (recommended for installation)</li>
</ul>
</li>
<li>The dependencies ship under their own licenses and are not part of this program</li>
</ul><h1>Features</h1>

<ul>
<li>[x] Autowiring</li>
<li>[x] Singletons</li>
<li>[x] Services</li>
<li>[ ] Hooks</li>
<li>[x] Modularization</li>
<li>[x] Autoloading</li>
</ul><h1>Installation</h1>

<pre><code>git clone git@github.com:t3elmar/Cool.git
</code></pre>

<h1>Autowiring - Dependency injection for dummies</h1>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">People</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Beer</span>   <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Music</span>  <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> 

<span class="k">class</span> <span class="nc">Party</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">People</span> <span class="nv">$people</span><span class="p">,</span> <span class="nx">Beer</span> <span class="nv">$beer</span><span class="p">,</span> <span class="nx">Music</span> <span class="nv">$music</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Cool\Container</span><span class="p">();</span>
<span class="nv">$party</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">getInstance</span><span class="p">(</span><span class="s1">'Party'</span><span class="p">);</span>

<span class="c1">// And the party is up and running ...</span>
</pre></div>

<h2>Autowiring, the details</h2>

<p>Autowiring is triggert by a call to <code>getInstance($classname)</code> 
of the container.  It is based on the signature of the constructor. </p>

<p>For each parameter in the construtor definition a classname has 
to be specified. Else it doesn't works and an error is thrown. 
It tries to to create an instance for each parameter 
by a recursive call to <code>getInstance</code>.</p>

<p>If <code>getInstance()</code> doesn't do what you want, you can still fall back
to the static call to <code>new</code> or implement your own factory.</p>

<h3>Out-look</h3>

<blockquote>
<p>The recursive auto-instantiation of objects is a nice feature,
but not the definition and strength of dependency injection.
The strenght is flexibility. Future versions will provide mechanism,
to replace classes (or interfaces in general) by subclasses 
through configuration.</p>
</blockquote>

<h1>Singletons</h1>

<p>By implementing the interface <code>\Cool\Singleton</code> an object is managed as 
Singleton by the container, as long as it called by the conatainer
methods <code>getInstance</code>, <code>getService</code> or <code>getHook</code>.</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">SantaClaus</span> <span class="k">implements</span> <span class="nx">\Cool\Singleton</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>

<p>The interface itself is empty. It serves as a flag.</p>

<h1>Services</h1>

<p>A service is a class, that implements a service interface.</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">PizzaCourier</span> <span class="k">implements</span> <span class="nx">PizzaService</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>

<p>This interface defines the type of the service. 
It must extend <code>\Cool\Service</code>.</p>

<div class="highlight"><pre><span class="k">interface</span> <span class="nx">PizzaService</span> <span class="k">extends</span> <span class="nx">\Cool\Service</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</pre></div>

<p>Interface <code>\Cool\Service</code> has one class method <code>canServe($mixedCriteria)</code>.</p>

<p>When it's method <code>getService($serviceType , $mixedCriteria)</code> is called,
the container asks all classes of the given service type, if they 
could serve the request. The first service that answers with TRUE 
is the winner. It is instantiated and returned ready to do the job. </p>

<h3>Out-look</h3>

<blockquote>
<p>This is the most simple algorythm to find the winnig service, but it's 
simplicity by intention. Inject your own finders in future versionsns.</p>
</blockquote>

<div class="highlight"><pre><span class="c1">// ... Concierge get me a pizza service! </span>
<span class="c1">// ... We have a surprising monday party and the fridge is empty.</span>

<span class="nv">$pizzaService</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">getService</span><span class="p">(</span>
                <span class="s1">'MyModule\PizzaService'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'dayOfWeek'</span> <span class="o">=&gt;</span> <span class="s1">'monday'</span><span class="p">));</span>

<span class="c1">//  Concierge wiring some pizza services, </span>
<span class="c1">//  all closed on monday, until suddenly ...</span>

<span class="k">class</span> <span class="nc">PizzaCourier</span> <span class="k">implements</span> <span class="nx">PizzaService</span> <span class="p">{</span>  
    <span class="c1">// ...</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">canServe</span><span class="p">(</span><span class="nv">$mixedCriteria</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">return</span> <span class="p">(</span><span class="nv">$mixedCriteria</span><span class="p">[</span><span class="s1">'dayOfWeek'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'tuesday'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<h3>Hint</h3>

<blockquote>
<p>It depends on the service type, what <code>canServe</code> uses as $mixedCriteria 
and how it evaluates its answer. If you don't set a stricter type for
$mixedCriteria in the interface definition,  you should at least 
document it in that place.</p>
</blockquote>

<h3>Hint</h3>

<blockquote>
<p>canServe is a <strong>static</strong> method, a <strong>class method</strong>.</p>

<p>To get inheritance work with static methods and variables,
<strong>late static bindings</strong> are your friends:
<a href="http://www.php.net/manual/en/language.oop5.late-static-bindings.php">http://www.php.net/manual/en/language.oop5.late-static-bindings.php</a></p>
</blockquote>

<p>Services are autoregistered. They must stay in a module directory
named <code>Services/</code> to work, while the interface definition belongs 
into <code>Interfaces/</code>.</p>

<pre><code>MyModule/Interfaces/PizzaService.php
MyModule/Services/PizzaCourier.php
</code></pre>

<h3>Hint</h3>

<blockquote>
<p>Instantiation is delegated to <code>getInstance</code>. That means that a service 
must provide a construtor that satisfies the criteria of <code>getInstance</code>.</p>
</blockquote>

<h1>Hooks</h1>

<p>Not implemented yet.</p>

<h1>Modularization</h1>

<p>A module is created by putting a directory into <code>Modules</code>.</p>

<pre><code>Cool/Modules/MyModule/
</code></pre>

<p>The Module hierarchy is flat. If you want to introduce hierarchy,
you have to do this in Form of the name. </p>

<pre><code>Cool/Modules/MyCompanyMySuperModule/
</code></pre>

<p>The subdirectories <code>Interfaces</code>, <code>Classes</code>, <code>Hooks</code> and <code>Services</code>
are the places where the autoloader is looking for. If your pathes
differ from this, you have to provide your own loading mechanism.</p>

<pre><code>MyModule/Interfaces/
MyModule/Classes/
MyModule/Hooks/
MyModule/Services/
</code></pre>

<p>Hooks and Services must stay in their matching directory to 
be autoregistered.</p>

<pre><code>MyModule/Hooks/
MyModule/Services/
</code></pre>

<p>Other recommended Directories</p>

<pre><code>MyModule/Configuration/
MyModule/Executables/
MyModule/Documentation/
MyModule/Tests/
</code></pre>

<h1>Coding guidelines</h1>

<p>The coding guidelines are recommendations. They don't differ from
the up-to-date mainstream:</p>

<ul>
<li>Use CamelCase as far as possible.</li>
<li>Classnames start uppercase, functions and variables lowercase.</li>
<li>Constants are all uppercase: TRUE, FALSE </li>
<li>Respect the security requirements of PHP programming</li>
<li>Wrap all PHP code into classes, even configurations.</li>
<li>Use namespaces.</li>
<li>Write configurations as PHP array for now.</li>
<li>Put a license into your module.</li>
<li>When you call code from other modules, adhere their licences.
They may not be as liberal as the Cool framework itself.</li>
</ul><h1>Goals of the design</h1>

<ul>
<li>Small footprint.</li>
<li>Feature minimized. Features can be added by modules.</li>
<li>Easy to get started.</li>
<li>Human readable namings.</li>
<li>Flat organization of module directories.</li>
<li>Proofed by unit testing </li>
<li>MIT license, to let modules choose their own way </li>
</ul><h1>Hello World</h1>

<p>Hello world as a service.</p>

<h2>Setting up directories</h2>

<div class="highlight"><pre><span class="nb">cd </span>Cool/Modules/
mkdir HelloWorld/
<span class="nb">cd </span>HelloWorld/
mkdir Executables Configuration Interfaces Classes Services
</pre></div>

<h2>GreeterService interface</h2>

<p>Path <code>Interfaces/GreeterService.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">interface</span> <span class="nx">GreeterService</span> <span class="k">extends</span> <span class="nx">\Cool\Service</span> <span class="p">{</span>
    <span class="c1">// expects morning | evening| other string</span>
    <span class="k">public</span> <span class="k">static</span> <span class="nx">CanServe</span><span class="p">(</span><span class="nv">$timeOfDay</span><span class="p">);</span>
    <span class="k">public</span> <span class="nx">greet</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>Greeter services</h2>

<p>Path <code>Services/MorningGreeter.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">MorningGreeter</span> <span class="k">implements</span> <span class="nx">GreeterService</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="nx">CanServe</span><span class="p">(</span><span class="nv">$timeOfDay</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$timeOfDay</span> <span class="o">==</span> <span class="s1">'morning'</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nx">greet</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="s1">'Good morning, '</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">'!'</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>Path <code>Services/EveningGreeter.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">EveningGreeter</span> <span class="k">implements</span> <span class="nx">GreeterService</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="nx">CanServe</span><span class="p">(</span><span class="nv">$timeOfDay</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$timeOfDay</span> <span class="o">==</span> <span class="s1">'evening'</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nx">greet</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="s1">'Good evening, '</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">'!'</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>Path <code>Services/DefaultGreeter.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">DefaultGreeter</span> <span class="k">implements</span> <span class="nx">GreeterService</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="nx">canServe</span><span class="p">(</span><span class="nv">$timeOfDay</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">return</span> <span class="nv">$timeOfDay</span> <span class="o">!=</span> <span class="s1">'evening'</span> <span class="o">&amp;&amp;</span> <span class="nv">$timeOfDay</span> <span class="o">!=</span> <span class="s1">'morning'</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nx">greet</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="s1">'Hello '</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">'!'</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>The program</h2>

<p>Path <code>Classes/HelloWorld.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Program</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$container</span><span class="p">;</span>

    <span class="c1">// The container (a singleton) will inject itself. </span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">\Cool\Container</span> <span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span> <span class="o">=</span> <span class="nv">$container</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">go</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$timeOfDay</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTimeOfDay</span><span class="p">();</span>
        <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">getService</span><span class="p">(</span><span class="s1">'HelloWorld\GreeterService'</span><span class="p">,</span> <span class="nv">$timeOfDay</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">greet</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// returns a string: morning | evening | other</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTimeOfDay</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>Configuration</h2>

<p>Path <code>Configuration/Main.php</code>:</p>

<div class="highlight"><pre><span class="o">&lt;</span><span class="nx">php</span> <span class="nx">namepace</span> <span class="nx">HelloWorld</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Main</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="nx">main</span><span class="p">(</span><span class="nv">$argv</span><span class="p">)</span> <span class="p">{</span> 
        <span class="nv">$moduleBase</span> <span class="o">=</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../..'</span><span class="p">;</span>
        <span class="k">require_once</span><span class="p">(</span><span class="nv">$moduleBase</span><span class="o">.</span><span class="s1">'/Cool/Classes/AutoLoader.php'</span><span class="p">);</span>
        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Cool\AutoLoader</span><span class="p">();</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addModuleBase</span><span class="p">(</span><span class="nv">$moduleBase</span><span class="p">);</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">go</span><span class="p">();</span>
        <span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Cool\DedicatedDirectoriesLoader</span><span class="p">();</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">addModuleBase</span><span class="p">(</span><span class="nv">$moduleBase</span><span class="p">);</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">go</span><span class="p">();</span>
        <span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Cool\Container</span><span class="p">();</span>
        <span class="nv">$program</span> <span class="o">=</span> <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">getInstance</span><span class="p">(</span><span class="s1">'HelloWorld\Program'</span><span class="p">);</span>
        <span class="c1">// the user provides his name as argument</span>
        <span class="nv">$program</span><span class="o">-&gt;</span><span class="na">go</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>Executable</h2>

<p>Path <code>Executables/sayHello.sh</code>:</p>

<div class="highlight"><pre><span class="c1">#! /usr/bin/env php</span>
<span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">require_once</span><span class="p">(</span><span class="nx">__DIR__</span><span class="o">.</span><span class="s2">"/../Configuration/Main.php"</span><span class="p">);</span>
<span class="nx">\HelloWorld\Main</span><span class="o">::</span><span class="na">main</span><span class="p">(</span><span class="nv">$argv</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>make it executable:</p>

<div class="highlight"><pre>chmod +x Executables/sayHello.sh
</pre></div>

<h1>TODO</h1>

<ul>
<li>Hooks</li>
<li>Add customized finders</li>
<li>Improve documentation</li>
<li>Improve documentation of the code</li>
<li>More unit testing</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cool maintained by <a href="https://github.com/t3elmar">t3elmar</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
